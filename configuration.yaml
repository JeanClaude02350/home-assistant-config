# configuration de Home Assistant

homeassistant:
  name: Maison
  latitude: !secret homeassistant_latitude
  longitude: !secret homeassistant_longitude
  elevation: !secret homeassistant_elevation
  time_zone: Europe/Paris
  country: FR
  external_url: !secret homeassistant_external
  internal_url: !secret homeassistant_interne
  allowlist_external_dirs:
    - /config
  customize: !include customize.yaml
  
http:
  use_x_forwarded_for: true
  trusted_proxies:
    - !secret proxyserver

default_config:

# ajout de cette partie pour icones personnalisées
frontend:
  extra_module_url:
    - /local/custom-brand-icons.js
    - /hacsfiles/hass-hue-icons/hass-hue-icons.js

  themes: !include_dir_merge_named themes

#logger:
#  default: error
#  logs:
#    homeassistant.components.ble_monitor: debug

recorder:
# gere les donnees sauvegardees en DB
  auto_purge: true
  purge_keep_days: 7 # durée de conservation des données
  exclude: # permet d'exclure tous les éléments listé ci-dessous de votre base de données
    domains: # filtrage par domaine
      - automation
      - camera
      - device_tracker
      - group
      - input_datetime
      - light
      - person
      - script
      - sun
      - switch
      - vacuum
      - weather
      - zone
    entities: # filtrage par entités spécifiques
      - sun.sun
      - sensor.last_boot
      - sensor.date
      - sensor.time
      - sensor.date_time
      - sensor.hacs
    entity_globs:
      - sensor.*uptime*
      - sensor.docker_*
      - sensor.unifi_gateway_*
    event_types: # filtrage par evenements
      - call_service 

###################################################################
########    Configuration de la partie systeme     ###############
###################################################################

########    Configuration de la partie materiel    ###############

# InfluxDB
influxdb:
  host: !secret ip_influxdb
  port: !secret port_influxdb
  database: !secret influxdb_database_ha
  username: !secret influxdb_username_ha
  password: !secret influxdb_password_ha
  max_retries: 3
  default_measurement: state

# Arrosage automatique Rainbird (ne marche pas en Prod pour le moment car une seule connexion possible)
#rainbird:
#  host: !secret rainbird_ip
#  password: !secret rainbird_password
#  trigger_time:
#    minutes: 6

###################################################################
##########          Utilisation Browser Mod           #############
###################################################################

browser_mod: 
  prefix: "browser_"

###################################################################
##########            Les compte-à-rebours            #############
###################################################################

timer:
  test:
    duration: "00:00:10"
  coton40:
    duration: "03:00:00"
  synthetique30:
    duration: "02:40:00"
  rapide:
    duration: "00:30:00"

###################################################################
##########              Les lumieres                 ##############
###################################################################

light:

  - platform: group
    name: Sam
    entities:
      - light.salle_a_manger_01
      - light.salle_a_manger_02
      - light.salle_a_manger_03
      - light.salle_a_manger_04
      - light.salle_a_manger_05
      - light.salle_a_manger_06

  - platform: group
    name: Parents
    entities:
      - light.chambre_parentale_1
      - light.chambre_parentale_2
      - light.chambre_parentale_3
      - light.chambre_parentale_4

  - platform: group
    name: Maxence
    entities:
      - light.hue_white_lamp_1

  - platform: group
    name: Chloe
    entities:
      - light.hue_ambiance_lamp_1

  - platform: group
    name: Garage
    entities:
      - light.lumiere_07_sous_sol

# Input text

input_text:
  cycle_filtration:
    name: cycle filtration
    initial: pas de cycle définit

###################################################################
##########               Input Boolean                ##############
###################################################################

input_boolean:

# Machine à laver
  machine_en_cours:
    name: machine en cours
    icon: mdi:washing-machine

# Input boolean courrier
  courrier_present:
    name: courrier
    icon: mdi:mail

# Input boolean impression 3D
  nouvelle_impression:
    name: Nouvelle impression 3D
    icon: mdi:printer-3D

# Input boolean impression 3D
  arret_imprimante:
    name: Arret de l'imprimante
    icon: mdi:printer-3D
    
# Input boolean reset filament
  reset_filament:
    name: Reset Filament
    icon: mdi:ubisoft

# pour activer ou non les alertes au paradis
  alarme_activation:
    name: Activer alarme paradis
    icon: mdi:alarm-light

  notification_connexion_distante:
    name: notification mqtt distant
    icon: mdi:alarm-light

# retour d'état des volets
  volet_pitchouns:
    name: volet des pitchouns
    icon: mdi:cover

  volet_salon:
    name: volet du salon
    icon: mdi:cover

  volet_cuisine:
    name: volet de la cuisine
    icon: mdi:cover

input_select:
  pool_pump_mode:
    name: Pool Pump mode
    options:
      - 'Auto'
      - 'On'
      - 'Off'
    initial: 'Auto'
    icon: mdi:water-pump
    
###################################################################
##########               Input Number                ##############
###################################################################

input_number:

  pool_water_temperature:
    name: temperature piscine
    min: 15.00
    max: 35.00
    unit_of_measurement: "°C"

  cout_m3_eau:
    name: Cout €/m3
    icon: mdi:currency-eur
    initial: 4
    min: 3.00
    max: 10.00
    unit_of_measurement: "€"
    mode: box
  
  ##############  Gestion des filaments dans lovelace    #################
  longueur_filament_totale:
   min: 0
   max: 330

  longueur_filament:
   min: 0
   max: 330
  
  filament_noir:
   min: 0
   max: 330

  filament_noir_restant:
   min: 0
   max: 330
   
  filament_bleu:
   min: 0
   max: 330

  filament_bleu_restant:
   min: 0
   max: 330

  filament_orange:
   min: 0
   max: 330
   
  filament_orange_restant:
   min: 0
   max: 330
   
  filament_gris:
   min: 0
   max: 330

  filament_gris_restant:
   min: 0
   max: 330

  filament_violet:
   min: 0
   max: 330

  filament_violet_restant:
   min: 0
   max: 330

  filament_blanc:
   min: 0
   max: 330

  filament_blanc_restant:
   min: 0
   max: 330

  filament_vert:
   min: 0
   max: 330

  filament_vert_restant:
   min: 0
   max: 330

###################################################################
##########               Les volets                  ##############
###################################################################

#cover:

#  - platform: mqtt
#    name: "Volet cuisine"
#    command_topic: "volet/cuisine"
#    payload_open: "u"
#    payload_close: "d"
#    payload_stop: "s"
#    state_open: "open"
#    state_closed: "closed"

#  - platform: mqtt
#    name: "Volet salon"
#    command_topic: "volet/salon"
#    payload_open: "u"
#    payload_close: "d"
#    payload_stop: "s"
#    state_open: "open"
#    state_closed: "closed"

#  - platform: mqtt
#    name: "Volet parent"
#    command_topic: "volet/chambre_parentale"
#    payload_open: "u"
#    payload_close: "d"
#    payload_stop: "s"
#    state_open: "open"
#    state_closed: "closed"
  
#  - platform: mqtt
#    name: "Volet pitchouns"
#    command_topic: "volet/chambre_pitchouns"
#    payload_open: "u"
#    payload_close: "d"
#    payload_stop: "s"
#    state_open: "open"
#    state_closed: "closed"


###################################################################
##########              Les sensors                  ##############
###################################################################

sensor:
    
# Date au format français
  - platform: template
    sensors:
      consommation_gaz:
        friendly_name: "consommation gaz"
        unit_of_measurement: 'm³'
        value_template: "{{ states('input_number.compteur_gaz') | int / 1000 | round(3) }}"
        device_class: energy

  - platform: template
    sensors:
      date_longue: 
        friendly_name: 'Date'
        value_template: >
          {% set months = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"] %}
          {% set month = months[now().strftime('%m') | int -1] %}
          {{ now().strftime('%d') + ' ' + month }}

# Pour la météo
      weather_temperature:
        friendly_name: "Weather Température"
        value_template: "{{ state_attr('weather.sillingy' , 'temperature') }}°"
      
      weather_icon:
        value_template: >-
          {% set weather_icon = states('weather.sillingy') 
            | replace('rainy', '☔️')
            | replace('partlycloudy', '⛅️')
            | replace('cloudy', '☁️')
            | replace('clear-night', '✨')
            | replace('fog', '🌀')
            | replace('hail', '🌧')
            | replace('lightning-rainy', '⛈')
            | replace('lightning', '⚡️') 
            | replace('pourring', '️☔️')
            | replace('snowy-rainy', '❄️️')
            | replace('snowy', '❄️')
            | replace('sunny', '☀️')
            | replace('windy-variant', '💨')
            | replace('windy', '💨')
            | replace('exceptional', '⚠️') %}     
          {% if not state_attr('weather.maison', 'temperature') == 'Indisponible' -%}
            {% if states('weather.beaucouze') == 'lightning-rainy' -%}
              ⛈
            {% else -%}
            {{ weather_icon }}
            {% endif -%}
          {% else -%}
          {% endif -%}

 # Température max prévue du jour
      weather_temperature_max:
        friendly_name: Weather Température Max
        value_template: "{{ states.weather.sillingy.attributes.forecast[0].temperature|float|round(2) }}"
       
 # Température mini prévue du jour
      weather_temperature_mini:
        friendly_name: Weather Température Mini
        value_template: "{{ states.weather.sillingy.attributes.forecast[0].templow|float|round(2) }}"

      weather_leve_soleil:
        friendly_name: Soleil levé
        value_template: >-
            {{as_timestamp(states.sun.sun.attributes.next_rising) | timestamp_custom("%-Hh%M")  }}

      weather_couche_soleil:
        friendly_name: Soleil couché
        value_template: >-
            {{as_timestamp(states.sun.sun.attributes.next_setting) | timestamp_custom("%-Hh%M")  }}

      meteo_force_du_vent:
        friendly_name: "Force du vent"
        value_template: >-
         {% set ventVitesse = states.sensor.sillingy_wind_speed.state|float|round(2) %}
         {% if ventVitesse < 0.3 %}
           Air calme
         {% elif ventVitesse >= 0.3 and ventVitesse <= 1.5 %}
           Air léger
         {% elif ventVitesse >= 1.6 and ventVitesse <= 3.3 %}
           Légère brise
         {% elif ventVitesse >= 3.4 and ventVitesse <= 5.4 %}
           Brise légère
         {% elif ventVitesse >= 5.5 and ventVitesse <= 7.9 %}
           Vent modéré
         {% elif ventVitesse >= 8 and ventVitesse <= 10.7 %}
           Brise fraîche
         {% elif ventVitesse >= 10.8 and ventVitesse <= 13.8 %}
           Forte brise
         {% elif ventVitesse >= 13.9 and ventVitesse <= 17.1 %}
           Vent fort
         {% elif ventVitesse >= 17.2 and ventVitesse <= 20.7 %}
           Coup de vent
         {% elif ventVitesse >= 20.8 and ventVitesse <= 24.4 %}
           Coup de vent de ficelle
         {% elif ventVitesse >= 24.5 and ventVitesse <= 28.4 %}
           Tempête
         {% elif ventVitesse >= 28.5 and ventVitesse <= 32.6 %}
          Tempête violente
         {% elif ventVitesse >= 32.7 %}
           Ouragan
         {% else %}
          Pas de vent         
         {%- endif %}

      meteo_indice_uv:
        friendly_name: "Météo indice UV"
        value_template: >-
          {% set indice_uv = states.sensor.sillingy_uv.state|float|round(0) %}
          Indice UV 
          {%if indice_uv <= 2  %}
             {{indice_uv}} : Faible
          {% elif indice_uv >= 3 and indice_uv <= 5  %}
             {{indice_uv}} : Moyen
          {% elif indice_uv >= 6 and indice_uv <= 7  %}
             {{indice_uv}} : Elevé
          {% elif indice_uv >= 8 and indice_uv <= 10  %}
             {{indice_uv}} : Très élevé
          {% elif indice_uv >= 11 %}
             {{indice_uv}} : Extrême
          {%- else -%}
            ERROR
          {%- endif %}             
          
# Nombre de personne dans la maison

      compteur_home:
        friendly_name: Compteur Personnes à la maison         
        value_template: >-
          {% set pers = [
           states.person.thomas,
           states.person.delphine,           
           ] %}
          {{ pers | selectattr('state','eq','home') | list | count }}

# Pour la carte chauffage

      netatmo_temperature_courante:
        friendly_name: Température Entrée
        device_class: temperature
        unit_of_measurement: "°C"
        value_template: "{{ state_attr('climate.piece_de_vie', 'current_temperature') }}"

      netatmo_temperature_consigne:
        friendly_name: température consigne Entrée
        device_class: temperature
        unit_of_measurement: "°C"
        value_template: "{{ state_attr('climate.piece_de_vie', 'temperature') }}"

      netatmo_hvac_modes:
        friendly_name: Hvac modes Entrée
        value_template: "{{ state_attr('climate.piece_de_vie', 'hvac_modes') }}"

      netatmo_preset_mode:
        friendly_name: Preset mode Entrée
        value_template: "{{ state_attr('climate.piece_de_vie', 'preset_mode') }}"

# passage du temps onduleur en minute
      ups_battery_runtime_friendly:
        friendly_name: 'temps restant'
        value_template: >- 
          {% set time = (states.sensor.ups_battery_runtime.state | int) | int %}
          {% set minutes = ((time % 3600) / 60) | int %}
          {% set hours = ((time % 86400) / 3600) | int %}
          {% set days = (time / 86400) | int %}
    
          {%- if time < 60 -%}
            Less than a minute
            {%- else -%}
            {%- if days > 0 -%}
              {{ days }}d
            {%- endif -%}
            {%- if hours > 0 -%}
              {%- if days > 0 -%}
                {{ ' ' }}
              {%- endif -%}
              {{ hours }}h
            {%- endif -%}
            {%- if minutes > 0 -%}
              {%- if days > 0 or hours > 0 -%}
                {{ ' ' }}
              {%- endif -%}
              {{ minutes }}m
            {%- endif -%}
          {%- endif -%}

# Connaitre la saison
# désormais dans UI directement
#  - platform: season

# remontée des informations du compteur de gaz

  - platform: 'gazpar'
#    name: 'gazpar'
    username: !secret grdf_username
    password: !secret grdf_password
    pce_identifier: !secret grdf_pceidentifier
    tmpdir: '/tmp'
    scan_interval: '08:00:00'

# Fete du jour
  - platform: rest
    resource: https://fetedujour.fr/api/v2/nRVZvUKXwD6GKaBr/json
    name: Fete du jour
    value_template: "{{ value_json.name }}"

# Unifi controller

  - platform: unifigateway
    version: UDMP-unifiOS
    host: !secret unifi_host
    username: !secret unifi_username
    password: !secret unifi_password
    monitored_conditions:
      - www
      - wlan
      - lan
      - wan
      - alerts
      - firmware

  - platform: command_line
    command: 'python3 scripts/unifi_switch.py'
    command_timeout: 60
    name: unifi_switch
    value_template: '{{ value_json.Ports_used }}'
    unit_of_measurement: Clients
    scan_interval: 120
    json_attributes:
        - Model
        - Temp
        - Activity
        - CPU
        - RAM  
        - Uptime
        - Ports_used      
        - Ports_user
        - Ports_guest
        - Update

  - platform: template
    sensors:  
      unifi_switch_temp:
          value_template: >
              {{ states.sensor.unifi_switch.attributes.Temp }}
          friendly_name_template: Switch Temp
          unit_of_measurement: '℃'
      unifi_switch_activity:
          value_template: >
              {{ states.sensor.unifi_switch.attributes.Activity }}
          unit_of_measurement: 'Mbps'
          friendly_name_template: Switch       
      unifi_switch_ram:
          value_template: >
              {{ states.sensor.unifi_switch.attributes.RAM }}
          unit_of_measurement: '%'
          friendly_name_template: Switch RAM
      unifi_switch_cpu:
          value_template: >
              {{ states.sensor.unifi_switch.attributes.CPU }}
          unit_of_measurement: '%'
          friendly_name_template: Switch CPU   
      unifi_switch_model:
          value_template: >
              {{ states.sensor.unifi_switch.attributes.Model  }}
          friendly_name_template: Model
      unifi_switch_users:
          value_template: >
              {{ states.sensor.unifi_switch.attributes.Ports_user }}
          friendly_name_template: Users
      unifi_switch_guests:
          value_template: >
              {{ states.sensor.unifi_switch.attributes.Ports_guest }}
          friendly_name_template: Guest
      unifi_switch_update:
          value_template: >
              {% if is_state_attr('sensor.unifi_switch', 'Update' , false) %}
                No
              {% else %}
                Available
              {% endif %}
          friendly_name_template: Switch Updates

  - platform: command_line
    command: 'python3 scripts/unifi_ap.py'
    command_timeout: 60
    name: unifi_ap
    value_template: '{{ value_json.Clients }}'
    unit_of_measurement: Clients
    scan_interval: 120
    json_attributes:
        - Guests
        - Clients_wifi0
        - Clients_wifi1
        - Score  
        - CPU
        - RAM
        - Uptime
        - Score_wifi0
        - Score_wifi1
        - Activity
        - Update

  - platform: template
    sensors:  
      unifi_ap_guests:
          value_template: >
              {{ states.sensor.unifi_ap.attributes.Guests }}
          friendly_name_template: Unifi AP Guests    
      unifi_ap_activity:
          value_template: >
              {{ states.sensor.unifi_ap.attributes.Activity }}
          unit_of_measurement: 'Mbps'
          friendly_name_template: Unifi AP Activity      
      unifi_ap_ram:
          value_template: >
              {{ states.sensor.unifi_ap.attributes.RAM }}
          unit_of_measurement: '%'
          friendly_name_template: Unifi AP RAM    
      unifi_ap_cpu:
          value_template: >
              {{ states.sensor.unifi_ap.attributes.CPU }}
          unit_of_measurement: '%'
          friendly_name_template: Unifi AP CPU
      unifi_ap_score:
          value_template: >
              {{ states.sensor.unifi_ap.attributes.Score }}
          friendly_name_template: Unifi AP SCORE
      unifi_ap2_score:
          value_template: >
              {% if is_state_attr('sensor.unifi_ap', 'Score_wifi0' , -1) %}
                N/A
              {% else %}
                {{ states.sensor.unifi_ap.attributes.Score_wifi0 }}.
              {% endif %}
          friendly_name_template: Unifi AP 2.4gHz SCORE
      unifi_ap5_score:
          value_template: >
              {% if is_state_attr('sensor.unifi_ap_', 'Score_wifi1' , -1) %}
                N/A
              {% else %}
                {{ states.sensor.unifi_ap.attributes.Score_wifi1 }}.
              {% endif %}
          friendly_name_template: Unifi AP 5gHz SCORE
      unifi_ap_wifi_devices:
          value_template: >
              {{ states.sensor.unifi_ap.attributes.Clients_wifi0 }}
          friendly_name_template: Unifi AP 2.4gHz Clients
      unifi_ap5ghz_wifi_devices:
          value_template: >
              {{ states.sensor.unifi_ap.attributes.Clients_wifi1 }}
          friendly_name_template: Unifi AP 5gHz Clients
      unifi_ap_update:
          value_template: >
              {% if is_state_attr('sensor.unifi_ap', 'Update' , false) %}
                No
              {% else %}
                Available
              {% endif %}
          friendly_name_template: Unifi AP Updates


# Imprimante 3D

  - platform: template
    sensors:
      quantite_filament_imprime:
        friendly_name: "quantité de filament total imprimé"
        unit_of_measurement: "m"
        value_template: >-
            {{ states.sensor.quantite_filament_imprime | float + states('input_number.longueur_filament')|float  }}

# Consommation d'eau

  - platform: template
    sensors:
      consommation_eau_quotidien_litre_precedent:
        friendly_name: "consommation historique"
        unit_of_measurement: "L"
        value_template: >-
            {{ states.sensor.eau_quotidien.attributes.last_period | float * 1000}}

  - platform: template
    sensors:
      consommation_eau_semaine_litre_precedent:
        friendly_name: "consommation historique"
        unit_of_measurement: "L"
        value_template: >-
            {{ states.sensor.eau_semaine.attributes.last_period | float * 1000}}

  - platform: template
    sensors:
      consommation_eau_mois_litre_precedent:
        friendly_name: "consommation historique"
        unit_of_measurement: "L"
        value_template: >-
            {{ states.sensor.eau_mois.attributes.last_period | float * 1000}}

  - platform: template
    sensors:
    ## consommation depuis le 12/02/2021
      consommation_eau:
        friendly_name: "consommation m3"
        value_template:  >-
            {{ (states("sensor.consommation_total")|float - 160.314)|round(3)}}
        unit_of_measurement: "m3"
        availability_template: >
          {% if is_state("sensor.consommation_total", "unknown") %}
            false
          {% else %}
            true
          {%- endif %}

  - platform: template
    sensors:
    ## consommation en L
      consommation_eau_heure_litre:
        friendly_name: "consommation"
        value_template:  >-
            {{ (states("sensor.eau_heure")|float * 1000)|round(2)}}
        unit_of_measurement: "L"
        availability_template: >-
            {% if is_state("sensor.eau_heure", "unknown") %}
              false
            {% else %}
              true
            {%- endif %}

  - platform: template
    sensors:
    ## consommation en L
      consommation_eau_quotidien_litre:
        friendly_name: "consommation"
        value_template:  >-
            {{ (states("sensor.eau_quotidien")|float * 1000)|round(2)}}
        unit_of_measurement: "L"
        availability_template: >-
            {% if is_state("sensor.eau_quotidien", "unknown") %}
              false
            {% else %}
              true
            {%- endif %}

  - platform: template
    sensors:
    ## consommation en L
      consommation_eau_semaine_litre:
        friendly_name: "consommation"
        value_template:  >-
            {{ (states("sensor.eau_semaine")|float * 1000)|round(2)}}
        unit_of_measurement: "L"
        availability_template: >-
            {% if is_state("sensor.eau_semaine", "unknown") %}
              false
            {% else %}
              true
            {%- endif %}

  - platform: template
    sensors:
    ## consommation en L
      consommation_eau_annee_litre:
        friendly_name: "consommation"
        value_template:  >-
            {{ (states("sensor.eau_annee")|float * 1000)|round(2)}}
        unit_of_measurement: "L"
        availability_template: >-
            {% if is_state("sensor.eau_annee", "unknown") %}
              false
            {% else %}
              true
            {%- endif %}

  - platform: template
    sensors:
    ## consommation en L
      consommation_eau_mois_litre:
        friendly_name: "consommation"
        value_template:  >-
            {{ (states("sensor.eau_mois")|float * 1000)|round(2)}}
        unit_of_measurement: "L"
        availability_template: >-
            {% if is_state("sensor.eau_mois", "unknown") %}
              false
            {% else %}
              true
            {%- endif %}

  - platform: template
    sensors:
    ## calcul cout de ma consommation d'eau
      eau_cout_jour:
        friendly_name: "Cout eau jour"
        value_template:  >-
            {{ (states("sensor.eau_quotidien")|float * states.input_number.cout_m3_eau.state|float)|round(2)}}
        unit_of_measurement: "€"
      eau_cout_semaine:
        friendly_name: "Cout eau semaine"
        value_template:  >-
             {{ (states("sensor.eau_semaine")|float * states.input_number.cout_m3_eau.state|float)|round(2)}}
      eau_cout_mois:
        friendly_name: "Cout eau mois"
        value_template:  >-
            {{ (states("sensor.eau_mois")|float * states.input_number.cout_m3_eau.state|float)|round(2)}}
        unit_of_measurement: "€"
      eau_cout_annee:
        friendly_name: "Cout eau annee"
        value_template:  >-
             {{ (states("sensor.eau_annee")|float * states.input_number.cout_m3_eau.state|float)|round(2)}}
        unit_of_measurement: "€"

# calcul du nombre de portes / fenetres ouvertes
  - platform: template
    sensors:
      number_of_doors_home:
        friendly_name: "Number of doors home"
        icon_template: hass:door-open
        value_template: >-
          {% set count = namespace(value=0) %}
          {% for entity_id in state_attr('group.all_doors_sensor_entities','entity_id') %}
            {% if (states(entity_id) == 'On') %}
              {% set count.value = count.value + 1 %}
            {% endif %}
          {% endfor %}
          {{ count.value }}

      number_of_smoke_home:
        friendly_name: "Number of smoke home"
        icon_template: mdi:smoke-detector
        value_template: >-
          {% set count = namespace(value=0) %}
          {% for entity_id in state_attr('group.all_smoke_sensor_entities','entity_id') %}
            {% if (states(entity_id) == 'On') %}
              {% set count.value = count.value + 1 %}
            {% endif %}
          {% endfor %}
          {{ count.value }}

# calcul du nombre de personnes présentes
  - platform: template
    sensors:
      number_of_persons_home:
        friendly_name: "Number of persons home"
        icon_template: mdi:account-circle
        value_template: >-
          {% set count = namespace(value=0) %}
          {% for entity_id in state_attr('group.all_person_entities','entity_id') %}
            {% if (states(entity_id) == 'home') %}
              {% set count.value = count.value + 1 %}
            {% endif %}
          {% endfor %}
          {{ count.value }}

# calcul du nombre de détecteurs de présence
      number_of_motion_sensors_on:
        friendly_name: "Number of Motion Sensors On"
        icon_template: mdi:run
        value_template: >-
          {% set count = namespace(value=0) %}
          {% for entity_id in state_attr('group.all_motion_sensor_entities','entity_id') %}
            {% if (states(entity_id) == 'on') %}
              {% set count.value = count.value + 1 %}
            {% endif %}
          {% endfor %}
          {{ count.value }}

  - platform: template
    sensors:
      pluie_semaine_derniere:
        friendly_name: "pluie semaine derniere"
        unit_of_measurement: "mm"
        value_template: >-
            {{ states.sensor.pluie_semaine.attributes.last_period }}

      pluie_mois_dernier:
        friendly_name: "pluie mois dernier"
        unit_of_measurement: "mm"
        value_template: >-
            {{ states.sensor.pluie_mois.attributes.last_period }}

      pluie_annee_derniere:
        friendly_name: "pluie annee derniere"
        unit_of_measurement: "mm"
        value_template: >-
            {{ states.sensor.pluie_annee.attributes.last_period }}

  - platform: template # Consommation journalière HP + HC
    sensors:
      vph_energy_total_daily:
        friendly_name: 'Energie journalière consommée par VPH'
        entity_id:
          - sensor.vph_consommation_quotidienne_jour
          - sensor.vph_consommation_quotidienne_nuit
        value_template: "{{ (states('sensor.vph_consommation_quotidienne_jour')|float + states('sensor.vph_consommation_quotidienne_nuit')|float)|round(3) }}"
        unit_of_measurement: "kWh"

  - platform: template
    sensors:
      energie_vph:
        friendly_name: "energie VPH"
        value_template:  >-
            {{ (states("sensor.vph_energy")|float / 1000)|round(3)}}
        unit_of_measurement: kWh
        availability_template: >-
            {% if is_state("sensor.vph_energy", "unknown") %}
              false
            {% else %}
              true
            {%- endif %}

  - platform: template # Consommation hebdo HP + HC
    sensors:
      vph_energy_total_weekly:
        friendly_name: 'Energie hebdomadaire consommée par VPH'
        entity_id:
          - sensor.vph_consommation_hebdo_jour
          - sensor.vph_consommation_hebdo_nuit
        value_template: "{{ (states('sensor.vph_consommation_hebdo_jour')|float + states('sensor.vph_consommation_hebdo_nuit')|float)|round(3) }}"
        unit_of_measurement: "kWh"

  - platform: template # Consommation mensuelle HP + HC
    sensors:
      vph_energy_total_monthly:
        friendly_name: 'Energie mensuelle consommée par VPH'
        entity_id:
          - sensor.vph_consommation_mensuelle_jour
          - sensor.vph_consommation_mensuelle_nuit
        value_template: "{{ (states('sensor.vph_consommation_mensuelle_jour')|float + states('sensor.vph_consommation_mensuelle_nuit')|float)|round(3) }}"
        unit_of_measurement: "kWh"

  - platform: template # Consommation annuelle HP + HC
    sensors:
      vph_energy_total_yearly:
        friendly_name: 'Energie annuelle consommée par VPH'
        entity_id:
          - sensor.vph_consommation_annuelle_jour
          - sensor.vph_consommation_annuelle_nuit
        value_template: "{{ (states('sensor.vph_consommation_annuelle_jour')|float + states('sensor.vph_consommation_annuelle_nuit')|float)|round(3) }}"
        unit_of_measurement: "kWh"

# Informations à propos de HACS
  - platform: command_line
    name: hacs_version
    scan_interval: 86400
    command: >
      grep -oP '"version": "\K[^"]+' custom_components/hacs/manifest.json

# CHECK DE LA MISE A JOUR DE VALETUDO
#  - platform: mqtt
#    name: version_valetudo
#    state_topic: "homeassistant/vacuum/valetudo_conchita/config"
#    value_template: "2021.03.0"
#    scan_interval: 21600

#  - platform: command_line
#    name: latest_valetudo
#    command: curl -s https://github.com/Hypfer/Valetudo/releases/latest | cut -d'"' -f2 | rev | cut -d'/' -f1 | rev
#    scan_interval: 21600

# Pour la filtration de la piscine

  - platform: template
    sensors:
      duree_filtration:
        friendly_name: "temps de filtration"
        unit_of_measurement: "h"
        value_template: >-
            {{ (states("sensor.temp_humidite_10_piscine_temperature")|float / 2)|round(0) }}

# Quelques statistiques sur HASS

  - platform: template
    sensors:

    #----- Nombre d'automations
      count_automations:
        friendly_name: 'automations'
        icon_template: mdi:robot
        value_template: "{{ states.automation | list | length }}"

    #----- Nombre de Scripts
      count_scripts:
        friendly_name: 'scripts'
        icon_template: mdi:script-text
        value_template: "{{ states.script| list | length }}"

    #----- Nombre de Device Trackers
      count_device_trackers:
        friendly_name: 'trackers'
        value_template: "{{ states.device_tracker | list | length }}"

    #----- Nombre de Binary Sensors
      count_binary_sensors:
        friendly_name: 'binary sensors'
        value_template: "{{ states.binary_sensor| list | length }}"

    #----- Nombre de Sensors
      count_sensors:
        friendly_name: 'sensors'
        icon_template: mdi:leak
        value_template: "{{ states.sensor | list | length }}"

    #----- Nombre de Switches
      count_switches:
        friendly_name: 'switch'
        icon_template: mdi:light-switch
        value_template: "{{ states.switch | list | length }}"

    #----- Nombre de Zones
      count_zones:
        friendly_name: 'zones'
        value_template: "{{ states.zone | list | length }}"

    #----- Nombre de Lights
      count_lights:
        friendly_name: 'lumieres'
        icon_template: mdi:lightbulb-group
        value_template: "{{ states.light | list | length }}"

  # Lumieres

  - platform: template
    sensors:
      all_lights_maison:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_maison','entity_id')) | selectattr('state','eq','on') | list | count }}
      all_lights_salon:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_salon','entity_id')) | selectattr('state','eq','on') | list | count }}
      all_lights_sam:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_sam','entity_id')) | selectattr('state','eq','on') | list | count }}
      all_lights_cuisine:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_cuisine','entity_id')) | selectattr('state','eq','on') | list | count }}
      all_lights_chloe:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_chloe','entity_id')) | selectattr('state','eq','on') | list | count }}
      all_lights_maxence:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_maxence','entity_id')) | selectattr('state','eq','on') | list | count }}
      all_lights_parents:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_parents','entity_id')) | selectattr('state','eq','on') | list | count }}
      all_lights_entree:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_entree','entity_id')) | selectattr('state','eq','on') | list | count }}
      all_lights_garage:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_garage','entity_id')) | selectattr('state','eq','on') | list | count }}
  
  # compter toutes les lumières connectées de la maison

      all_lights_unavailable:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_maison','entity_id')) | selectattr('state','eq','unavailable') | list | count }}
      all_lights:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_lights_maison','entity_id')) | list | count }}
      all_lights_available:
        value_template: >
          {% set t = states | selectattr('entity_id','in',state_attr('group.all_lights_maison','entity_id')) | selectattr('state','eq','unavailable') | list | count %}
          {% set y = states | selectattr('entity_id','in',state_attr('group.all_lights_maison','entity_id')) | list | count %}
          {{ (y - t) }}

  # compter tous les capteurs de température
      all_temp:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_temp_maison','entity_id')) | list | count }}
      all_temp_available:
        value_template: >
          {% set t = states | selectattr('entity_id','in',state_attr('group.all_temp_maison','entity_id')) | selectattr('state','eq','unavailable') | list | count %}
          {% set y = states | selectattr('entity_id','in',state_attr('group.all_temp_maison','entity_id')) | list | count %}
          {{ (y - t) }}

  # compter tous les capteurs de mouvement
      all_move:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_motion_sensor_entities','entity_id')) | list | count }}
      all_move_available:
        value_template: >
          {% set t = states | selectattr('entity_id','in',state_attr('group.all_motion_sensor_entities','entity_id')) | selectattr('state','eq','unavailable') | list | count %}
          {% set y = states | selectattr('entity_id','in',state_attr('group.all_motion_sensor_entities','entity_id')) | list | count %}
          {{ (y - t) }}

  # compter tous les capteurs d'ouverture / fermeture de porte
      all_door:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_doors_sensor_entities','entity_id')) | list | count }}
      all_door_available:
        value_template: >
          {% set t = states | selectattr('entity_id','in',state_attr('group.all_doors_sensor_entities','entity_id')) | selectattr('state','eq','unavailable') | list | count %}
          {% set y = states | selectattr('entity_id','in',state_attr('group.all_doors_sensor_entities','entity_id')) | list | count %}
          {{ (y - t) }}

  # pour les personnes

  - platform: template
    sensors:
      all_person_entities:
        value_template: >
          {{ states | selectattr('entity_id','in',state_attr('group.all_person_entities','entity_id')) | selectattr('state','eq','home') | list | count }}

  # NUC
  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: /
      - type: memory_use_percent
      - type: processor_use
      - type: last_boot
      - type: network_in
        arg: eth0
      - type: network_out
        arg: eth0
      - type: ipv4_address
        arg: eth0


#  - platform: uptime
# supprimé dans la version 2022.12

  - platform: time_date
    display_options:
      ['time', 'date']

  # CREATION DE VARIABLE POUR LE THERMOSTAT
  - platform: template
    sensors:
      temperature_thermostat:
        friendly_name: 'Temperature thermostat'
        value_template: "{{ state_attr('climate.piece_de_vie', 'current_temperature') }}"
        attribute_templates:
          unit_of_measurement: "°C"

  - platform: template
    sensors:
      temperature_cible:
        friendly_name: 'Temperature cible'
        value_template: "{{ state_attr('climate.piece_de_vie', 'temperature') }}"
        attribute_templates:
          unit_of_measurement: "°C"

  - platform: template
    sensors:
      netatmo_hvac_action:
        friendly_name: 'chauffage'
        value_template: "{{ 'off' if state_attr('climate.piece_de_vie', 'hvac_action') == 'idle' else 'on'}}"

  # POUR LES CAMERAS EUFY

  # POUR OBTENIR L'ETAT DES CMARERAS EUFY
  - platform: rest
    name: eufy_status
    resource: !secret eufy_guard_mode
    scan_interval: 10
    value_template: >-
      {% set v = value | replace('"', "")|int  %}
      {{ {0: "Away",
          1: "Home",
          2: "Schedule",
          3: "Custom1",
          4: "Custom2",
          5: "Custom3",
          47: "Geofence",
          63: "Disarmed"}[v] | default("Unknown state:" + (value|urlencode)) }}

  # QUELQUES REMONTEES D'INFOS DES CAMERAS EUFY
  - platform: rest
    name: camera_jardin_battery_level
    resource: !secret eufy_jardin_batterie
    scan_interval: 10
    device_class: battery
    unit_of_measurement: '%'

  - platform: rest
    name: camera_arriere_maison_battery_level
    resource: !secret eufy_arriere_batterie
    scan_interval: 10
    device_class: battery
    unit_of_measurement: '%'

  - platform: rest
    name: camera_arriere_maison_motion_detection
    resource: !secret eufy_arriere_mouvement
    scan_interval: 10

  - platform: rest
    name: camera_jardin_motion_detection
    resource: !secret eufy_jardin_mouvement
    scan_interval: 10

  # CAPTEURS SWITCHBOT

  # Thermometre
  - platform: rest
    name: temperature baie technique
    resource: !secret switchbot_temp_baie_url
    method: GET
    scan_interval: 300
    headers:
      Authorization: !secret switchbot_api
      Content-Type: 'application/json'
    value_template: '{{ value_json.body.temperature }}'
    json_attributes_path: "$.body"
    json_attributes:
      - humidity

  # Capteur de porte
  - platform: rest
    name: porte descente garage
    resource: !secret switchbot_porte_garage_url
    method: GET
    scan_interval: 300
    headers:
      Authorization: !secret switchbot_api
      Content-Type: 'application/json'
    value_template: '{{ value_json.body.openState }}'
    json_attributes_path: "$.body"
    json_attributes:
      - moveDetected

  # SURVEILLANCE SYSTEME MAISON DE FAMILLE
  - platform: template
    sensors:
      systeme:
        friendly_name: Surveillance systeme
        value_template: >-      
          {%- if states('sensor.rpi_diskusage')| float < 70 and
           states('sensor.rpi_cpu_temp')| float < 65 and
           states('sensor.disponibilite') =='online'
          -%}
           Tout est OK
          {% else -%}
           AVERTISSEMENT
          {% endif -%}

  # SURVEILLANCE MAISON DE FAMILLE
      surveillance:
        friendly_name: Surveillance
        value_template: >-      
          {%- if states('binary_sensor.mb_capteur_ouverture_02_porte_fenetre_contact') =='Off' and
           states('binary_sensor.mb_capteur_ouverture_01_porte_entree_contact') =='On' and
           states('binary_sensor.0x00158d0008091c38_contact') =='Off' and
           states('binary_sensor.mb_capteur_ouverture_03_fenetre_cuisine_contact') =='Off'
          -%}
           Tout est OK
          {% else -%}
           AVERTISSEMENT
          {% endif -%}

mqtt:
  sensor:
    # Consommation d'eau via MQTT
    - name: "consommation total"
      state_topic: "tele/eau/consommation"
      unit_of_measurement: "m³"
      state_class: total_increasing
      device_class: water
      value_template: "{{ value_json['total_m3']}}"
      icon: mdi:counter

    - name: "compteur eau status"
      state_topic: "tele/eau/consommation"
      value_template: "{{ value_json['status']}}"

    # MQTT DEPUIS MAISON DE FAMILLE
    - name: "disponibilité"
      state_topic: "paradis/bridge/state"

    - name: "temperature exterieur"
      state_topic: "paradis/capteur_exterieur/temperature"
      unit_of_measurement: "°C"

    - name: "humidite exterieur"
      state_topic: "paradis/capteur_exterieur/humidite"
      unit_of_measurement: "%"

#    - name: rpi cpu load
#      state_topic: "paradis/raspberrypi/cpuload"
#      unit_of_measurement: "%"

#    - name: rpi cpu temp
#      state_topic: "paradis/raspberrypi/cputemp"
#      unit_of_measurement: "°C"

#    - name: rpi diskusage
#      state_topic: "paradis/raspberrypi/diskusage"
#      unit_of_measurement: "%"

#    - name: rpi swap
#      state_topic: "paradis/raspberrypi/swap"
#      unit_of_measurement: "%"

#    - name: rpi memory
#      state_topic: "paradis/raspberrypi/memory"
#      unit_of_measurement: "%"

#    - name: rpi uptime
#      state_topic: "paradis/raspberrypi/uptime_days"
#      unit_of_measurement: "days"

  # Imprimante 3D
    - name: "Longueur Filament"
      state_topic: "octoPrint/hass/printing"
      unit_of_measurement: "m"
      value_template: "{{ ((value_json.job.filament.length)|float * 0.001)|round(2) }}"
      json_attributes_topic: "octoPrint/hass/printing"
      json_attributes_template: "{{ value_json.job.filament | tojson }}"

    - name: "dispo imprimante"
      state_topic: "octoPrint/hass/Connected"

###################################################################
########                   BINARY SENSOR                  #########
###################################################################

binary_sensor:

  #TEST BONNE REPONSE RASPBERRYPI POUR CONSO EAU
  - platform: ping
    host: !secret rasp_baie_technique
    name: "RaspberryPi baie technique"

  #TEST BONNE REPONSE RASPBERRYPI OCTOPRINT
  - platform: ping
    host: !secret rasp_octoprint
    name: "RaspberryPi Octoprint"

  #TEST BONNE REPONSE RASPBERRYPI POUR BLUETOOTH
  - platform: ping
    host: !secret rasp_salon
    name: "RaspberryPi Salon"

  #TEST BONNE REPONSE SERVEUR DOMESTIQUE
  - platform: ping
    host: !secret nuc_serveur_domestique
    name: "Serveur domestique"
  
  #TEST BONNE REPONSE VPS OVH
  - platform: ping
    host: !secret vps_ovh
    name: "VPS OVH"

  #TEST BONNE REPONSE RASPBERRYPI DISTANT
  - platform: ping
    host: !secret vpn_paradis
    name: "RaspberryPi Distant"


###################################################################
########                   UTILITY METER                  #########
###################################################################

utility_meter:

######   CALCUL CONSOMMATION ELECTRIQUE BAIE TECHNIQUE   ######

  consommation_baie_quotidienne:
    source: sensor.consommation_baie_technique
    cycle: daily

  consommation_baie_hebdo:
    source: sensor.consommation_baie_technique
    cycle: weekly

  consommation_baie_mensuelle:
    source: sensor.consommation_baie_technique
    cycle: monthly

  consommation_bureau_thomas_quotidienne:
    source: sensor.consommation_bureau_thomas
    cycle: daily

  consommation_bureau_thomas_hebdo:
    source: sensor.consommation_bureau_thomas
    cycle: weekly

  consommation_bureau_thomas_mensuelle:
    source: sensor.consommation_bureau_thomas
    cycle: monthly

  consommation_machine_laver_quotidienne:
    source: sensor.prise_05_machine_a_laver_energy
    cycle: daily

  consommation_machine_laver_hebdo:
    source: sensor.prise_05_machine_a_laver_energy
    cycle: weekly

  consommation_machine_laver_mensuelle:
    source: sensor.prise_05_machine_a_laver_energy
    cycle: monthly

  vph_consommation_quotidienne:
    source: sensor.energie_vph
    name: consommation quotidienne VPH
    cycle: daily
    tariffs:
      - jour
      - nuit

  vph_consommation_hebdo:
    source: sensor.energie_vph
    name: consommation hebdomadaire VPH
    cycle: weekly
    tariffs:
      - jour
      - nuit

  vph_consommation_mensuelle:
    source: sensor.energie_vph
    name: consommation mensuelle VPH
    cycle: monthly
    tariffs:
      - jour
      - nuit

  vph_consommation_trimestrielle:
    source: sensor.energie_vph
    name: consommation trimestrielle VPH
    cycle: quarterly
    tariffs:
      - jour
      - nuit

  vph_consommation_annuelle:
    source: sensor.energie_vph
    name: consommation annuelle VPH
    cycle: yearly
    tariffs:
      - jour
      - nuit


######  CALCUL CONSOMMATION EAU  ######

  eau_mois:
    source: sensor.consommation_total
    cycle: monthly

  eau_semaine:
    source: sensor.consommation_total
    cycle: weekly

  eau_quotidien:
    source: sensor.consommation_total
    cycle: daily

  eau_heure:
    source: sensor.consommation_total
    net_consumption: true
    cycle: hourly
  eau_annee:
    source: sensor.consommation_total
    net_consumption: true
    cycle: yearly

######   CALCUL PLUIE   ######

  pluie_heure_netatmo:
    source: sensor.netatmo_maison_piece_de_vie_pluviometre_rain_today
    cycle: hourly
  pluie_aujourdhui_netatmo:
    source: sensor.netatmo_maison_piece_de_vie_pluviometre_rain_today
    cycle: daily
  pluie_semaine_netatmo:
    source: sensor.netatmo_maison_piece_de_vie_pluviometre_rain_today
    cycle: weekly
  pluie_mois_netatmo:
    source: sensor.netatmo_maison_piece_de_vie_pluviometre_rain_today
    cycle: monthly
  pluie_annee_netatmo:
    source: sensor.netatmo_maison_piece_de_vie_pluviometre_rain_today
    cycle: yearly

  pluie_aujourdhui:
    source: sensor.netatmo_maison_piece_de_vie_pluviometre_rain_today
    net_consumption: true
    cycle: daily

  pluie_semaine:
    source: sensor.netatmo_maison_piece_de_vie_pluviometre_rain_today
    net_consumption: true
    cycle: weekly

  pluie_mois:
    source: sensor.netatmo_maison_piece_de_vie_pluviometre_rain_today
    net_consumption: true
    cycle: monthly

  pluie_annee:
    source: sensor.netatmo_maison_piece_de_vie_pluviometre_rain_today
    net_consumption: true
    cycle: yearly

######   CALCUL CONSOMMATION MASON DE FAMILLE   ######

  energie_quotidienne_mb:
    source: sensor.mb_lixee_base
    cycle: daily

  energie_hebdo_mb:
    source: sensor.mb_lixee_base
    cycle: weekly

  energie_mensuelle_mb:
    source: sensor.mb_lixee_base
    cycle: monthly

###################################################################
########                   CAMERAS                        #########
###################################################################

camera:

#caméra Ezviz C1C
  - platform: ffmpeg
    name: C1C
    input: !secret ezviz_c1c

#caméra Annke
  - platform: ffmpeg
    name: Annke_NC400
    input: !secret annkenc400

#pour la carte du robot aspirateur
#pas encore opérationnel pour le D9

###################################################################
########                   CONTROLE                       #########
###################################################################

rest_command:

#pour désactiver la surveillance des caméras EUFY
  eufy_guard_mode_home:
    url: !secret eufy_surveillance_activation

#pour activer la surveillance des caméras EUFY
  eufy_guard_mode_disarmed:
    url: !secret eufy_surveillance_desactivation

###################################################################
########                   SCRIPT                         #########
###################################################################

shell_command:

# pour connecter / déconnecter l'imprimante à Octoprint
  octoprint_connect: "curl -s http://192.168.10.20/api/connection -d '{\"command\":\"connect\"}' -H 'Content-Type: application/json' -H 'X-Api-Key: 4CF3F18366A146278ABF97002BF8D82A'"
  octoprint_disconnect: "curl -s http://192.168.10.20/api/connection -d '{\"command\":\"disconnect\"}' -H 'Content-Type: application/json' -H 'X-Api-Key: 4CF3F18366A146278ABF97002BF8D82A'"

###################################################################
########   Management de Docker et des divers Conteneurs  #########
###################################################################

monitor_docker:
  - name: Docker
    containers:
      - appdaemon
      - vscode
      - portainer
      - traefik
      - grafana
      - zwavejs2mqtt
      - zigbee2mqtt
      - adguardhome
      - homeassistant
      - influxdb
      - mqtt
      - 'node-red'
      - iobroker
      - bitwarden
      - heimdall
    rename:
      appdaemon: AppDaemon
      adguardhome: AdGuard
      homeassistant_prod: Home Assistant
    monitored_conditions:
      - version
      - containers_running
      - containers_total
      - state
      - status
      - memory

###################################################################
##########   Interactionn vocale et Notification  ################
##################################################################

# Ajout de télégram pour les notifications - A VOIR POUR METTRE DANS FICHIER SPECIFIQUE
telegram_bot:
  - platform: polling
    api_key: !secret telegram_token
    allowed_chat_ids: 
    - !secret id_telegram_thomas
    - !secret id_telegram_famille
      
notify:
  - platform: telegram
    name: telegram_thomas
    chat_id: !secret id_telegram_thomas
  - platform: telegram
    name: telegram_famille
    chat_id: !secret id_telegram_famille

# Text to speech
tts:
  - platform: google_translate
    language: 'fr'
    
# définition des différents switch 
switch: !include switch.yaml

# définition des groupes
group: !include groups.yaml

automation: !include automations.yaml
script: !include scripts.yaml
panel_iframe: !include panel_iframe.yaml
scene: !include scenes.yaml